(function(g){g(document).ready(function(){function h(b){function j(d,c){for(var a=d.length-1;0<=a;a--)if(d[a]==c)return!0;return!1}function f(d){return d.replace(/^\s+|\s+$/g,"")}function m(d){for(var c=[],a=d.length-1;0<=a;a--){var b=f(g(d[a]).text());j(c,b)||c.push(b)}return c}function n(b,c){j(b,f(c.text()))&&c.attr("selected",!0)}function h(b,c){j(b,f(c.text()))||c.attr("selected",!1)}function q(d,c){for(var a=b.children("option"),e=a.length-1;0<=e;e--)c(d,g(a[e]))}var p=m(b.children("option")),
k=m(b.children("option:selected")),e=g('<ul class="'+b.attr("id")+'_smart_tag"></ul>');b.before(e);e.css({"margin-left":"0px",width:"488px"});e.tagit({allowSpaces:!0,availableTags:p,afterTagAdded:function(d,c){var a=c.tagLabel;p=m(b.children("option"));if(j(p,a))q(e.tagit("assignedTags"),n);else{var f=b.attr("controller");if(f){var h=b.attr("action")?b.attr("action"):"create",l=b.attr("param")?b.attr("param"):"title",h="/"+(b.attr("controllers")?b.attr("controllers"):f+"s")+"/"+h,k={};k[f+"["+l+"]"]=
a;g.ajax({url:h,dataType:"json",type:"POST",data:k,success:function(c){c?b.prepend('<option selected="selected" value="'+c.id+'">'+a+"</option>"):console.log("josn is null")}})}else console.log("select's controller param is null")}},afterTagRemoved:function(){q(e.tagit("assignedTags"),h)}});for(var l=k.length-1;0<=l;l--)e.tagit("createTag",k[l]);b.change(function(){for(var d=m(b.children("option:selected")),c=e.tagit("assignedTags"),a=d.length-1;0<=a;a--)j(c,d[a])||e.tagit("createTag",d[a]);for(a=
c.length-1;0<=a;a--)j(d,c[a])||e.tagit("removeTagByLabel",c[a])})}for(var n=g(".smart_tag"),f=n.length-1;0<=f;f--)h(g(n[f]))})})(window.jQuery);