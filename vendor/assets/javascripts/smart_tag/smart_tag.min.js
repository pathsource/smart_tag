(function(g){g(document).ready(function(){function h(d){function j(a,c){for(var b=a.length-1;0<=b;b--)if(a[b]==c)return!0;return!1}function f(a){a=a.replace(/\ +/g,"");a=a.replace(/[ ]/g,"");return a.replace(/[\r\n]/g,"")}function m(a){for(var c=[],b=a.length-1;0<=b;b--){var d=f(g(a[b]).text());j(c,d)||c.push(d)}return c}function n(a,c){j(a,f(c.text()))&&c.attr("selected",!0)}function h(a,c){j(a,f(c.text()))||c.attr("selected",!1)}function q(a,c){for(var b=d.children("option"),e=b.length-1;0<=e;e--)c(a,
g(b[e]))}var p=m(d.children("option")),k=m(d.children("option:selected")),e=g('<ul class="'+d.attr("id")+'_smart_tag"></ul>');d.before(e);e.css({"margin-left":"0px",width:"488px"});e.tagit({availableTags:p,afterTagAdded:function(a,c){var b=c.tagLabel;p=m(d.children("option"));if(j(p,b))q(e.tagit("assignedTags"),n);else{var f=d.attr("controller");if(f){var h=d.attr("action")?d.attr("action"):"create",l=d.attr("param")?d.attr("param"):"title",h="/"+(d.attr("controllers")?d.attr("controllers"):f+"s")+
"/"+h,k={};k[f+"["+l+"]"]=b;g.ajax({url:h,dataType:"json",type:"POST",data:k,success:function(a){a?d.prepend('<option selected="selected" value="'+a.id+'">'+b+"</option>"):console.log("josn is null")}})}else console.log("select's controller param is null")}},afterTagRemoved:function(){q(e.tagit("assignedTags"),h)}});for(var l=k.length-1;0<=l;l--)e.tagit("createTag",k[l]);d.change(function(){for(var a=m(d.children("option:selected")),c=e.tagit("assignedTags"),b=a.length-1;0<=b;b--)j(c,a[b])||e.tagit("createTag",
a[b]);for(b=c.length-1;0<=b;b--)j(a,c[b])||e.tagit("removeTagByLabel",c[b])})}for(var n=g(".smart_tag"),f=n.length-1;0<=f;f--)h(g(n[f]))})})(window.jQuery);